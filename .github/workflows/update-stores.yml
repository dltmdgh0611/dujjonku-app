name: Update Stores Data

on:
  schedule:
    # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (GitHub ActionsëŠ” ìµœì†Œ 5ë¶„ ê°„ê²©)
    - cron: '*/10 * * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œì—ë„ ì‹¤í–‰

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # GitHub Pages ë°°í¬ ê¶Œí•œ
    
    steps:
      - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸ Python ì„¤ì •
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          pip install requests
      
      - name: ğŸª í¬ë¡¤ëŸ¬ ì‹¤í–‰
        run: |
          python crawler/crawl.py
          echo "í¬ë¡¤ë§ ì™„ë£Œ!"
          ls -lh public/stores.json
      
      - name: ğŸ“Š ë°ì´í„° í™•ì¸
        run: |
          echo "=== stores.json ë‚´ìš© ë¯¸ë¦¬ë³´ê¸° ==="
          head -c 200 public/stores.json
          echo ""
          echo "=== íŒŒì¼ í¬ê¸° ==="
          wc -c public/stores.json
      
      - name: ğŸš€ GitHub Pages ë°°í¬
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
          publish_branch: gh-pages
          force_orphan: true  # íˆìŠ¤í† ë¦¬ ì—†ì´ ë°°í¬ (ìš©ëŸ‰ ì ˆì•½)
          commit_message: 'ğŸª Update stores data - ${{ github.event.head_commit.message }}'
      
      - name: âœ… ì™„ë£Œ ì•Œë¦¼
        run: |
          echo "âœ… í¬ë¡¤ë§ ë° ë°°í¬ ì™„ë£Œ!"
          echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
          echo "ğŸŒ ë°°í¬ URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/stores.json"

